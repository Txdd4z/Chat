<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CHAT REAL COM ELA üî•</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #000;
            color: white;
            font-family: Arial, sans-serif;
            height: 100vh;
            overflow: hidden;
            touch-action: manipulation;
        }
        
        #tela-login {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .login-box {
            background: #111;
            padding: 25px;
            border-radius: 15px;
            width: 90%;
            max-width: 350px;
            text-align: center;
            border: 2px solid #0a84ff;
        }
        
        .login-box h1 {
            color: #0a84ff;
            margin-bottom: 10px;
            font-size: 1.8rem;
        }
        
        #input-senha {
            width: 100%;
            padding: 15px;
            margin: 15px 0;
            border-radius: 10px;
            border: 2px solid #333;
            background: #222;
            color: white;
            font-size: 1.1rem;
            text-align: center;
        }
        
        #btn-entrar {
            width: 100%;
            padding: 15px;
            background: #0a84ff;
            border: none;
            border-radius: 10px;
            color: white;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
        }
        
        #chat-area {
            display: none;
            height: 100vh;
            flex-direction: column;
        }
        
        .chat-topo {
            background: #111;
            padding: 15px;
            border-bottom: 2px solid #0a84ff;
            text-align: center;
        }
        
        .chat-topo h2 {
            color: #0a84ff;
            font-size: 1.3rem;
        }
        
        .mensagens {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            background: #000;
        }
        
        .msg {
            margin: 10px 0;
            padding: 12px 15px;
            border-radius: 18px;
            max-width: 85%;
            word-wrap: break-word;
        }
        
        .msg.voce {
            background: #0a84ff;
            margin-left: auto;
        }
        
        .msg.ela {
            background: #222;
            margin-right: auto;
            border: 1px solid #333;
        }
        
        .chat-input {
            background: #111;
            padding: 12px;
            display: flex;
            gap: 10px;
            border-top: 1px solid #222;
        }
        
        #input-msg {
            flex: 1;
            padding: 12px;
            border-radius: 20px;
            border: 2px solid #333;
            background: #222;
            color: white;
            font-size: 1rem;
        }
        
        #btn-enviar {
            background: #0a84ff;
            border: none;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
        }
        
        .online {
            font-size: 0.8rem;
            color: #0a84ff;
            margin-top: 5px;
        }
        
        .digitando {
            padding: 5px 15px;
            font-style: italic;
            color: #888;
            font-size: 0.9rem;
            display: none;
        }
    </style>
</head>
<body>
    <!-- TELA DE LOGIN -->
    <div id="tela-login">
        <div class="login-box">
            <h1>üí¨ CHAT COM ELA</h1>
            <p style="color: #888; margin-bottom: 10px;">Digite a senha para entrar</p>
            <input type="password" id="input-senha" placeholder="Senha: 0306">
            <button id="btn-entrar">üëâ ENTRAR NO CHAT</button>
            <p style="color: #666; margin-top: 15px; font-size: 0.8rem;">
                Dica: Use a senha <strong>0306</strong>
            </p>
        </div>
    </div>
    
    <!-- √ÅREA DO CHAT -->
    <div id="chat-area">
        <div class="chat-topo">
            <h2>üíï Conversa Privada</h2>
            <div class="online">‚óè Online</div>
        </div>
        
        <div class="mensagens" id="mensagens">
            <div class="msg ela">
                Aguardando conex√£o...
            </div>
        </div>
        
        <div class="digitando" id="digitando">
            <span id="quem-digita">Ela</span> est√° digitando...
        </div>
        
        <div class="chat-input">
            <input type="text" id="input-msg" placeholder="Escreva aqui..." autocomplete="off">
            <button id="btn-enviar">‚û§</button>
        </div>
    </div>

<script>
// Firebase configuration
const firebaseConfig = {
    databaseURL: "https://chat-5d4cd-default-rtdb.firebaseio.com/"
};

// Inicializar Firebase
firebase.initializeApp(firebaseConfig);
const database = firebase.database();

document.addEventListener('DOMContentLoaded', function() {
    // Elementos
    const telaLogin = document.getElementById('tela-login');
    const chatArea = document.getElementById('chat-area');
    const inputSenha = document.getElementById('input-senha');
    const btnEntrar = document.getElementById('btn-entrar');
    const inputMsg = document.getElementById('input-msg');
    const btnEnviar = document.getElementById('btn-enviar');
    const mensagensDiv = document.getElementById('mensagens');
    const digitandoDiv = document.getElementById('digitando');
    const quemDigita = document.getElementById('quem-digita');
    
    // Vari√°veis
    let meuNome = '';
    let meuId = '';
    let estouDigitando = false;
    let timeoutDigitando;
    
    // FUN√á√ÉO DE LOGIN - SIMPLES E FUNCIONAL
    function entrarNoChat() {
        const senha = inputSenha.value;
        
        // SENHAS V√ÅLIDAS
        const senhasValidas = ['0306', 'amor', 'senha', '123', 'admin', 'ela', 'voce'];
        
        if (senhasValidas.includes(senha)) {
            // Gera ID √∫nico
            meuId = 'user_' + Date.now() + '_' + Math.floor(Math.random() * 1000);
            meuNome = 'Usuario_' + Math.floor(Math.random() * 900 + 100);
            
            // Entra no chat
            telaLogin.style.display = 'none';
            chatArea.style.display = 'flex';
            
            // Foca no input
            setTimeout(() => {
                inputMsg.focus();
            }, 300);
            
            // Configura Firebase
            setupFirebase();
            
            // Vibra√ß√£o no celular
            if (navigator.vibrate) {
                navigator.vibrate([100, 50, 100]);
            }
            
        } else {
            // Senha errada
            inputSenha.style.borderColor = '#ff2a6d';
            inputSenha.style.transform = 'translateX(10px)';
            inputSenha.value = '';
            inputSenha.placeholder = 'Errado! Tente: 0306';
            
            setTimeout(() => {
                inputSenha.style.borderColor = '';
                inputSenha.style.transform = '';
                inputSenha.placeholder = 'Senha: 0306';
            }, 1000);
        }
    }
    
    // CONFIGURAR FIREBASE
    function setupFirebase() {
        // Adiciona usu√°rio online
        database.ref('online/' + meuId).set({
            nome: meuNome,
            hora: Date.now()
        });
        
        // Remove quando sair
        window.addEventListener('beforeunload', function() {
            database.ref('online/' + meuId).remove();
        });
        
        // Carrega √∫ltimas mensagens
        database.ref('mensagens').limitToLast(20).once('value')
            .then(snapshot => {
                const msgs = snapshot.val();
                if (msgs) {
                    // Limpa mensagem inicial
                    mensagensDiv.innerHTML = '';
                    
                    // Mostra mensagens antigas
                    Object.values(msgs).forEach(msg => {
                        adicionarMensagem(msg.texto, msg.quem, msg.quem === meuNome);
                    });
                }
            });
        
        // Escuta novas mensagens
        database.ref('mensagens').limitToLast(1).on('child_added', snapshot => {
            const msg = snapshot.val();
            if (msg.quem !== meuNome) {
                adicionarMensagem(msg.texto, msg.quem, false);
            }
        });
        
        // Escuta quem est√° digitando
        database.ref('digitando').on('value', snapshot => {
            const digitando = snapshot.val();
            let alguemDigitando = false;
            let quem = '';
            
            if (digitando) {
                Object.entries(digitando).forEach(([id, dados]) => {
                    if (id !== meuId && dados.ativo) {
                        alguemDigitando = true;
                        quem = dados.nome;
                    }
                });
            }
            
            if (alguemDigitando) {
                quemDigita.textContent = quem;
                digitandoDiv.style.display = 'block';
            } else {
                digitandoDiv.style.display = 'none';
            }
        });
    }
    
    // ADICIONAR MENSAGEM
    function adicionarMensagem(texto, quem, souEu) {
        const msgDiv = document.createElement('div');
        msgDiv.className = `msg ${souEu ? 'voce' : 'ela'}`;
        msgDiv.textContent = texto;
        
        // Efeito de entrada
        msgDiv.style.opacity = '0';
        msgDiv.style.transform = souEu ? 'translateX(20px)' : 'translateX(-20px)';
        
        mensagensDiv.appendChild(msgDiv);
        
        // Anima√ß√£o
        setTimeout(() => {
            msgDiv.style.transition = 'all 0.3s';
            msgDiv.style.opacity = '1';
            msgDiv.style.transform = 'translateX(0)';
        }, 10);
        
        // Scroll
        mensagensDiv.scrollTop = mensagensDiv.scrollHeight;
    }
    
    // ENVIAR MENSAGEM
    function enviarMensagem() {
        const texto = inputMsg.value.trim();
        if (texto === '') return;
        
        // Salva no Firebase
        database.ref('mensagens').push({
            texto: texto,
            quem: meuNome,
            hora: Date.now()
        });
        
        // Mostra localmente
        adicionarMensagem(texto, meuNome, true);
        
        // Limpa input
        inputMsg.value = '';
        
        // Para de mostrar "digitando"
        database.ref('digitando/' + meuId).remove();
        estouDigitando = false;
        clearTimeout(timeoutDigitando);
    }
    
    // DETECTAR DIGITA√á√ÉO
    inputMsg.addEventListener('input', function() {
        if (!estouDigitando) {
            estouDigitando = true;
            database.ref('digitando/' + meuId).set({
                nome: meuNome,
                ativo: true
            });
        }
        
        clearTimeout(timeoutDigitando);
        timeoutDigitando = setTimeout(() => {
            database.ref('digitando/' + meuId).remove();
            estouDigitando = false;
        }, 2000);
    });
    
    // EVENT LISTENERS
    
    // Login
    btnEntrar.addEventListener('click', entrarNoChat);
    inputSenha.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') entrarNoChat();
    });
    
    // Enviar mensagem
    btnEnviar.addEventListener('click', enviarMensagem);
    inputMsg.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            e.preventDefault();
            enviarMensagem();
        }
    });
    
    // Foco na senha ao carregar
    inputSenha.focus();
    
    // Touch events para melhor experi√™ncia mobile
    document.addEventListener('touchstart', function() {}, {passive: true});
});
</script>
</body>
</html>
